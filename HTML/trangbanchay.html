<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°n Ch·∫°y</title>

    <link rel="stylesheet" href="../CSS/bootstrap.min.css">
    <link rel="stylesheet" href="../fontawesomefree/css/all.min.css">
    <link rel="stylesheet" href="../CSS/style.css">

    <script src="../JS/jquery.js"></script>
    <script src="../JS/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background-color: #f9f9f9;
        }

        .main-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 25px;
            padding: 30px 50px;
        }

        /* Sidebar */
        .sidebar {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            height: fit-content;
        }

        .sidebar h5 {
            color: #ff6f61;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
            font-size: 15px;
        }

        .sidebar ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 20px;
        }

        .sidebar ul li {
            margin: 6px 0;
            cursor: pointer;
            color: #333;
            font-size: 15px;
        }

        .sidebar ul li:hover,
        .sidebar ul li.active {
            color: #ff6f61;
            font-weight: 600;
        }

        .price-filter label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
            font-size: 15px;
        }

        .price-filter input {
            margin-right: 8px;
            accent-color: #ff6f61;
            transform: scale(1.1);
        }

        /* Sort bar */
        .sort-bar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 20px;
        }

        .sort-select {
            border: 1px solid #ccc;
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 14px;
            color: #555;
            background-color: #fff;
            transition: all 0.2s;
        }

        .sort-select:focus {
            border-color: #ff6f61;
            box-shadow: 0 0 4px #ffb0a3;
            outline: none;
        }

        .display-wrapper {
            border: 1px solid #ddd;
            border-radius: 50px;
            background-color: #fff;
            padding: 3px 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Book grid */
        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 25px;
            padding: 20px 0;
        }

        .book-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            transition: 0.3s;
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .book-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .book-card img {
            height: 230px;
            width: 100%;
            object-fit: cover;
        }

        .book-card h6 {
            font-size: 15px;
            font-weight: 600;
            margin: 10px 8px 6px;
            color: #222;
            min-height: 42px;
        }

        .book-card .price {
            color: #d9534f;
            font-weight: bold;
            margin: 6px 0;
        }

        .book-card .sold {
            color: #777;
            font-size: 13px;
            margin-bottom: 10px;
        }

        .badge-hot {
            background-color: #ff6f61;
            color: white;
            font-size: 13px;
            border-radius: 5px;
            padding: 3px 7px;
            position: absolute;
            top: 10px;
            left: 10px;
        }

        .content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
    </style>
</head>

<body>
    <!-- HEADER -->
    <div class="header">
        <div class="logo">
            <a href="./tranggioithieu.html"><img src="../IMG/logo.png" alt="logo"></a>
        </div>
        <div class="search-box">
            <input type="text" placeholder="T√¨m s·∫£n ph·∫©m..." class="search-input">
        </div>
        <div class="nav">
            <a href="./trangchu.html">Trang Ch·ªß</a>
            <a href="./trangsachmoi.html">S√°ch M·ªõi</a>
            <a href="./trangbanchay.html" class="active">B√°n Ch·∫°y</a>
            <a href="./danhmucsanpham.html">Danh M·ª•c</a>
            <a href="./trangkhuyenmai.html">Khuy·∫øn M√£i</a>
        </div>
        <div class="user-cart">
            <a href="./tranggiohang.html" class="cart-link position-relative">
                <i class="fa-solid fa-cart-shopping"></i> Gi·ªè h√†ng
                <span id="cart-count"
                    class="badge bg-danger position-absolute top-0 start-100 translate-middle rounded-pill">0</span>
            </a>
            <a href="./trangdangnhap.html"><i class="fa-solid fa-user"></i> ƒêƒÉng nh·∫≠p</a>
        </div>

        <!-- ===== N·ªòI DUNG TRANG B√ÅN CH·∫†Y ===== -->
        <div class="main-container">
            <!-- Sidebar -->
            <div class="sidebar">
                <h5>Nh√≥m s·∫£n ph·∫©m</h5>
                <ul>
                    <li>T·∫•t c·∫£ s·∫£n ph·∫©m</li>
                    <li>S√°ch thi·∫øu nhi</li>
                    <li>Gi√°o khoa - Tham kh·∫£o</li>
                    <li>VƒÉn h·ªçc</li>
                    <li>T√¢m l√Ω - K·ªπ nƒÉng s·ªëng</li>
                    <li>Kinh t·∫ø</li>
                </ul>

                <h5 class="mt-4">Gi√°</h5>
                <div class="price-filter">
                    <label><input type="checkbox" /> 0ƒë - 150.000ƒë</label>
                    <label><input type="checkbox" /> 150.000ƒë - 300.000ƒë</label>
                    <label><input type="checkbox" /> 300.000ƒë - 500.000ƒë</label>
                    <label><input type="checkbox" /> 500.000ƒë - 700.000ƒë</label>
                    <label><input type="checkbox" /> Tr√™n 700.000ƒë</label>
                </div>
            </div>

            <!-- Content -->
            <div>
                <div class="banner">
                    <img src="../IMG/Hau1.png" alt="Banner 1" />
                    <img src="../IMG/Hau1.png" alt="Banner 2" />
                </div>

                <!-- Sort Bar -->
                <div class="sort-bar">
                    <div class="d-flex align-items-center justify-content-end w-100 gap-3">
                        <!-- √î 1: S·∫Øp x·∫øp -->
                        <div class="d-flex align-items-center">
                            <label for="sortSelect" class="me-2 fw-semibold text-secondary">S·∫Øp x·∫øp theo:</label>
                            <select id="sortSelect" class="sort-select">
                                <option value="banchay">B√°n ch·∫°y nh·∫•t</option>
                                <option value="giaTang">Gi√° tƒÉng d·∫ßn</option>
                                <option value="giaGiam">Gi√° gi·∫£m d·∫ßn</option>
                                <option value="ten">T√™n (A-Z)</option>
                            </select>
                        </div>

                        <!-- √î 2: Hi·ªÉn th·ªã -->
                        <div class="d-flex align-items-center gap-2">
                            <label class="fw-semibold text-secondary mb-0">Hi·ªÉn th·ªã:</label>
                            <div class="display-wrapper" id="displayCountBox">
                                <i class="fa-solid fa-grip text-muted"></i>
                                <span id="displayCount" class="fw-semibold text-secondary">0</span>
                                <span class="text-secondary" style="font-size: 14px;"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Danh s√°ch s√°ch -->
                <div class="book-grid" id="book-list"></div>
            </div>
        </div>

        <!-- N·ªòI DUNG -->
        <div class="main-container">
            <!-- SIDEBAR -->
            <div class="sidebar">
                <h5>Danh M·ª•c</h5>
                <ul></ul>
                <h5>Kho·∫£ng gi√°</h5>
                <div class="price-filter"></div>
            </div>

            <!-- PH·∫¶N S√ÅCH -->
            <div class="content">
                <div class="sort-bar">
                    <div class="d-flex align-items-center justify-content-end w-100 gap-3">
                        <div class="d-flex align-items-center">
                            <label for="sortSelect" class="me-2 fw-semibold text-secondary">S·∫Øp x·∫øp theo:</label>
                            <select id="sortSelect" class="sort-select">
                                <option value="banchay">B√°n ch·∫°y nh·∫•t</option>
                                <option value="giaTang">Gi√° tƒÉng d·∫ßn</option>
                                <option value="giaGiam">Gi√° gi·∫£m d·∫ßn</option>
                                <option value="ten">T√™n (A-Z)</option>
                            </select>
                        </div>

                        <div class="d-flex align-items-center gap-2">
                            <label class="fw-semibold text-secondary mb-0">Hi·ªÉn th·ªã:</label>
                            <div class="display-wrapper">
                                <i class="fa-solid fa-grip text-muted"></i>
                                <span id="displayCount" class="fw-semibold text-secondary">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="book-grid" id="book-list"></div>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <div>
                <h3>V·ªÅ Ch√∫ng T√¥i</h3>
                <ul>
                    <li><a href="./trangsitemap.html">Site Map</a></li>
                    <li><a href="#">Gi·ªõi thi·ªáu</a></li>
                    <li><a href="#">Tuy·ªÉn d·ª•ng</a></li>
                    <li><a href="#">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a></li>
                    <li><a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
                </ul>
            </div>
            <div>
                <h3>H·ªó Tr·ª£ Kh√°ch H√†ng</h3>
                <ul>
                    <li><a href="#">Trung t√¢m tr·ª£ gi√∫p</a></li>
                    <li><a href="#">H∆∞·ªõng d·∫´n mua h√†ng</a></li>
                    <li><a href="#">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
                    <li><a href="#">Li√™n h·ªá</a></li>
                </ul>
            </div>
            <div>
                <h3>K·∫øt N·ªëi V·ªõi Ch√∫ng T√¥i</h3>
                <div class="social-icons">
                    <a href="#"><i class="fa-brands fa-facebook"></i></a>
                    <a href="#"><i class="fa-brands fa-instagram"></i></a>
                </div>
                <p style="margin-top:10px; font-size:14px;">üìû Hotline: 1900 1234<br>‚úâÔ∏è Email:
                    T√™n_Nh√†_S√°ch@bookstore.vn</p>
            </div>
        </div>

        <script>
            async function loadBooksFromTrangChu() {
                try {
                    const res = await fetch("./trangchu.html");
                    const html = await res.text();
                    const match = html.match(/const books\s*=\s*(\[.*?\]);/s);
                    if (!match) throw new Error("Kh√¥ng t√¨m th·∫•y danh s√°ch s√°ch trong trang ch·ªß!");
                    return eval(match[1]);
                } catch (err) {
                    console.error("L·ªói khi ƒë·ªçc d·ªØ li·ªáu:", err);
                    return [];
                }
            }

            loadBooksFromTrangChu().then(books => {
                const container = document.getElementById("book-list");
                const sidebar = document.querySelector(".sidebar ul");
                const priceFilter = document.querySelector(".price-filter");
                const sortSelect = document.getElementById("sortSelect");
                const displayCount = document.getElementById("displayCount");

                if (!books.length) {
                    container.innerHTML = `<div class="text-center text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu.</div>`;
                    return;
                }

                const categories = [...new Set(books.map(b => b.category))];
                sidebar.innerHTML = `<li class="active" data-cat="all">T·∫•t c·∫£</li>` +
                    categories.map(cat => `<li data-cat="${cat}">${cat}</li>`).join("");

                const priceRanges = [
                    { label: "0ƒë - 150.000ƒë", min: 0, max: 150000 },
                    { label: "150.000ƒë - 300.000ƒë", min: 150000, max: 300000 },
                    { label: "300.000ƒë - 500.000ƒë", min: 300000, max: 500000 },
                    { label: "Tr√™n 500.000ƒë", min: 500000, max: Infinity }
                ];
                priceFilter.innerHTML = priceRanges.map(r =>
                    `<label><input type="checkbox" class="price-checkbox" data-min="${r.min}" data-max="${r.max}"/> ${r.label}</label>`
                ).join("");

                let baseList = [...books].sort((a, b) => b.purchases - a.purchases);
                let filtered = [...baseList];

                function render(list) {
                    container.innerHTML = "";
                    displayCount.textContent = list.length;
                    if (!list.length) {
                        container.innerHTML = `<div class="text-muted text-center w-100">Kh√¥ng c√≥ s·∫£n ph·∫©m ph√π h·ª£p</div>`;
                        return;
                    }
                    list.forEach((b, i) => {
                        const price = b.price || (b.gia ? b.gia.toLocaleString() + "ƒë" : "Li√™n h·ªá");
                        container.innerHTML += `
            <div class="book-card">
              ${i === 0 ? `<span class="badge-hot">B√°n ch·∫°y nh·∫•t</span>` : ""}
              <img src="${b.img}" alt="${b.name}">
              <h6>${b.name}</h6>
              <p class="price">${price}</p>
              <p class="sold">ƒê√£ b√°n: ${b.purchases}</p>
            </div>`;
                    });
                }

                function applyFilters() {
                    const activeCat = sidebar.querySelector("li.active").dataset.cat;
                    const checked = [...document.querySelectorAll(".price-checkbox:checked")];
                    filtered = books.filter(b => activeCat === "all" || b.category === activeCat);
                    if (checked.length) {
                        filtered = filtered.filter(b => {
                            const p = parseInt((b.price || "").replace(/\D/g, "")) || 0;
                            return checked.some(cb => p >= +cb.dataset.min && p < +cb.dataset.max);
                        });
                    }
                    applySort();
                }

                function applySort() {
                    const val = sortSelect.value;
                    const num = p => parseInt((p.price || "").replace(/\D/g, "")) || 0;
                    if (val === "giaTang") filtered.sort((a, b) => num(a) - num(b));
                    else if (val === "giaGiam") filtered.sort((a, b) => num(b) - num(a));
                    else if (val === "ten") filtered.sort((a, b) => a.name.localeCompare(b.name));
                    else filtered.sort((a, b) => b.purchases - a.purchases);
                    render(filtered);
                }

                sidebar.querySelectorAll("li").forEach(li => {
                    li.addEventListener("click", () => {
                        sidebar.querySelectorAll("li").forEach(x => x.classList.remove("active"));
                        li.classList.add("active");
                        applyFilters();
                    });
                });

                document.querySelectorAll(".price-checkbox").forEach(cb =>
                    cb.addEventListener("change", applyFilters)
                );

                sortSelect.addEventListener("change", applySort);
                render(filtered);
            });
        </script>
</body>

</html>