<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh To√°n</title>
    <link rel="stylesheet" href="../CSS/bootstrap.min.css">
    <link rel="stylesheet" href="../fontawesomefree/css/all.min.css">
    <link rel="stylesheet" href="../CSS/style.css">
    <script src="../JS/jquery.js"></script>
</head>

<body>
    <!-- HEADER -->
    <div class="header">
        <div class="logo">
            <a href="./tranggioithieu.html">
                <img src="../IMG/logo.png" alt="logo">
            </a>
        </div>
        <div class="nav">
            <a href="./trangchu.html">Trang Ch·ªß</a>
            <a href="./trangsachmoi.html">S√°ch M·ªõi</a>
            <a href="./trangbanchay.html">B√°n Ch·∫°y</a>
            <a href="./danhmucsanpham.html">Danh M·ª•c</a>
            <a href="./trangkhuyenmai.html">Khuy·∫øn M√£i</a>
        </div>
        <div class="user-cart">
            <a href="./tranggiohang.html"><i class="fa-solid fa-cart-shopping"></i> Gi·ªè h√†ng</a>
            <a href="./trangdangnhap.html"><i class="fa-solid fa-user"></i> ƒêƒÉng nh·∫≠p</a>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="container mt-5 mb-5">
        <h1 class="text-center mb-4">Thanh To√°n ƒê∆°n H√†ng</h1>

        <div class="row">
            <!-- C·ªòT 1: Th√¥ng tin ng∆∞·ªùi nh·∫≠n -->
            <div class="col-md-6">
                <h4>Th√¥ng Tin Ng∆∞·ªùi Nh·∫≠n</h4>
                <form id="payment-form" class="mt-3">
                    <div class="mb-3">
                        <label class="form-label">H·ªç v√† t√™n:</label>
                        <input type="text" id="fullname" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">S·ªë ƒëi·ªán tho·∫°i:</label>
                        <input type="tel" id="phone" class="form-control" pattern="[0-9]{10}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ƒê·ªãa ch·ªâ giao h√†ng:</label>
                        <textarea id="address" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ph∆∞∆°ng th·ª©c thanh to√°n:</label>
                        <select id="payment-method" class="form-select" required>
                            <option value="">-- Ch·ªçn ph∆∞∆°ng th·ª©c --</option>
                            <option value="cod">Thanh to√°n khi nh·∫≠n h√†ng (COD)</option>
                            <option value="bank">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</option>
                            <option value="momo">V√≠ MoMo</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success w-100 mt-3">
                        <i class="fa-solid fa-credit-card"></i> X√°c Nh·∫≠n Thanh To√°n
                    </button>
                </form>
            </div>

            <!-- C·ªòT 2: Hi·ªÉn th·ªã s·∫£n ph·∫©m t·ª´ gi·ªè h√†ng -->
            <div class="col-md-6">
                <h4>ƒê∆°n H√†ng C·ªßa B·∫°n</h4>
                <table class="table table-bordered mt-3 text-center align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>S√°ch</th>
                            <th>SL</th>
                            <th>Th√†nh Ti·ªÅn</th>
                        </tr>
                    </thead>
                    <tbody id="order-items">
                        <tr><td colspan="3" style="color:gray;">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o.</td></tr>
                    </tbody>
                </table>
                <h4 class="text-end">T·ªïng c·ªông: <span id="order-total" style="color:red;">0‚Ç´</span></h4>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        <div>
            <h3>V·ªÅ Ch√∫ng T√¥i</h3>
            <ul>
                <li><a href="./trangsitemap.html">Site Map</a></li>
                <li><a href="#">Gi·ªõi thi·ªáu</a></li>
                <li><a href="#">Tuy·ªÉn d·ª•ng</a></li>
                <li><a href="#">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a></li>
                <li><a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
            </ul>
        </div>

        <div>
            <h3>H·ªó Tr·ª£ Kh√°ch H√†ng</h3>
            <ul>
                <li><a href="#">Trung t√¢m tr·ª£ gi√∫p</a></li>
                <li><a href="#">H∆∞·ªõng d·∫´n mua h√†ng</a></li>
                <li><a href="#">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
                <li><a href="#">Li√™n h·ªá</a></li>
            </ul>
        </div>

        <div>
            <h3>K·∫øt N·ªëi V·ªõi Ch√∫ng T√¥i</h3>
            <div class="social-icons">
                <a href="#"><i class="fa-brands fa-facebook"></i></a>
                <a href="#"><i class="fa-brands fa-instagram"></i></a>
            </div>
            <p style="margin-top:10px; font-size:14px;">üìû Hotline: 1900 1234<br>‚úâÔ∏è Email: T√™n_Nh√†_S√°ch@bookstore.vn</p>
        </div>
    </div>

    <script src="../JS/bootstrap.bundle.js"></script>
    <script>
        // === 1Ô∏è‚É£ L·∫•y th√¥ng tin ng∆∞·ªùi d√πng ===
        let user = null;
        try {
            user = JSON.parse(localStorage.getItem('dangNhap'));
        } catch (e) {
            user = null;
        }

        // N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p th√¨ b·∫Øt quay l·∫°i ƒëƒÉng nh·∫≠p
        if (!user || !user.username) {
            alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ thanh to√°n!");
            window.location.href = "./trangdangnhap.html";
        }

        const username = user.username;
        const cartKey = `cart_${username}`;

        // === 2Ô∏è‚É£ Load s·∫£n ph·∫©m t·ª´ gi·ªè h√†ng ===
        function loadOrder() {
            const cart = JSON.parse(localStorage.getItem(cartKey)) || [];
            const tbody = document.getElementById('order-items');
            let total = 0;
            tbody.innerHTML = '';

            if (cart.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" style="color:gray;">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o.</td></tr>`;
                document.getElementById('order-total').textContent = "0‚Ç´";
                return;
            }

            // Duy·ªát t·ª´ng s·∫£n ph·∫©m trong gi·ªè h√†ng
            cart.forEach(item => {
                const priceNumber = Number(item.price.replace(/[^\d]/g, ''));
                const qty = item.quantity || 1;
                const subtotal = priceNumber * qty;
                total += subtotal;

                tbody.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${qty}</td>
                        <td>${subtotal.toLocaleString()}‚Ç´</td>
                    </tr>
                `;
            });

            // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
            document.getElementById('order-total').textContent = total.toLocaleString() + "‚Ç´";
        }

        // === 3Ô∏è‚É£ X·ª≠ l√Ω khi b·∫•m "X√°c nh·∫≠n thanh to√°n" ===
        document.getElementById('payment-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const fullname = document.getElementById('fullname').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const address = document.getElementById('address').value.trim();
            const method = document.getElementById('payment-method').value;

            if (!fullname || !phone || !address || !method) {
                alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!");
                return;
            }

            alert("‚úÖ Thanh to√°n th√†nh c√¥ng! C·∫£m ∆°n b·∫°n ƒë√£ mua h√†ng t·∫°i BookStore.");
            localStorage.removeItem(cartKey); // X√≥a gi·ªè h√†ng sau khi thanh to√°n
            window.location.href = "./trangchu.html";
        });

        // G·ªçi khi load trang
        loadOrder();
    </script>
</body>
</html>
